FROM tiangolo/meinheld-gunicorn-flask:python3.8-alpine3.11

RUN apk add --no-cache curl=7.67.0-r3 busybox=1.31.1-r10 musl-utils=1.1.24-r3 ssl_client=1.31.1-r10 gcc=9.3.0-r0 libc-dev=0.7.2-r0 g++=9.3.0-r0 libffi-dev=3.2.1-r6 libxml2=2.9.10-r4 unixodbc-dev=2.3.7-r2 libpq=12.6-r0 postgresql-dev=12.6-r0; \
    echo -e " #!/bin/bash\n\
    pip install -r requirements.txt; \
    pip install --upgrade meinheld; \
    pip freeze > requirements.txt; \
    pip install cyclonedx-bom==0.4.3; \
    cyclonedx-py -j -o /tmp/comp2env_bom.json; \
    python -m pip uninstall -y pip;" > /scan.sh; \
    chmod 777 /scan.sh; \
    echo > /app/prestart.sh

