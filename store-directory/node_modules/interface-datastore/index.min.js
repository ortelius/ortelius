(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.InterfaceDatastore = factory()}(typeof self !== 'undefined' ? self : this, function () {
var InterfaceDatastore=(()=>{var ae=Object.defineProperty;var ke=r=>ae(r,"__esModule",{value:!0});var m=(r,e)=>{ke(r);for(var t in e)ae(r,t,{get:e[t],enumerable:!0})};var Gt={};m(Gt,{Key:()=>f});var ce=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r));for(;r--;){let n=t[r]&63;n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n<63?e+="_":e+="-"}return e};var W={};m(W,{identity:()=>_e});function $e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),i=o.charCodeAt(0);if(t[i]!==255)throw new TypeError(o+" is ambiguous");t[i]=s}var d=r.length,p=r.charAt(0),N=Math.log(d)/Math.log(256),l=Math.log(256)/Math.log(d);function z(a){if(a instanceof Uint8Array||(ArrayBuffer.isView(a)?a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength):Array.isArray(a)&&(a=Uint8Array.from(a))),!(a instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(a.length===0)return"";for(var u=0,U=0,g=0,y=a.length;g!==y&&a[g]===0;)g++,u++;for(var x=(y-g)*l+1>>>0,b=new Uint8Array(x);g!==y;){for(var v=a[g],C=0,w=x-1;(v!==0||C<U)&&w!==-1;w--,C++)v+=256*b[w]>>>0,b[w]=v%d>>>0,v=v/d>>>0;if(v!==0)throw new Error("Non-zero carry");U=C,g++}for(var j=x-U;j!==x&&b[j]===0;)j++;for(var $=p.repeat(u);j<x;++j)$+=r.charAt(b[j]);return $}function k(a){if(typeof a!="string")throw new TypeError("Expected String");if(a.length===0)return new Uint8Array;var u=0;if(a[u]!==" "){for(var U=0,g=0;a[u]===p;)U++,u++;for(var y=(a.length-u)*N+1>>>0,x=new Uint8Array(y);a[u];){var b=t[a.charCodeAt(u)];if(b===255)return;for(var v=0,C=y-1;(b!==0||v<g)&&C!==-1;C--,v++)b+=d*x[C]>>>0,x[C]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");g=v,u++}if(a[u]!==" "){for(var w=y-g;w!==y&&x[w]===0;)w++;for(var j=new Uint8Array(U+(y-w)),$=U;w!==y;)j[$++]=x[w++];return j}}}function Re(a){var u=k(a);if(u)return u;throw new Error(`Non-${e} character`)}return{encode:z,decodeUnsafe:k,decode:Re}}var Fe=$e,Pe=Fe,de=Pe;var tr=new Uint8Array(0);var he=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},E=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var fe=r=>new TextEncoder().encode(r),pe=r=>new TextDecoder().decode(r);var le=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},be=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){return ge(this,e)}},me=class{constructor(e){this.decoders=e}or(e){return ge(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},ge=(r,e)=>new me({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),we=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new le(e,t,n),this.decoder=new be(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},F=({name:r,prefix:e,encode:t,decode:n})=>new we(r,e,t,n),D=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=de(t,e);return F({prefix:r,name:e,encode:n,decode:o=>E(s(o))})},qe=(r,e,t,n)=>{let s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let o=r.length;for(;r[o-1]==="=";)--o;let i=new Uint8Array(o*t/8|0),d=0,p=0,N=0;for(let l=0;l<o;++l){let z=s[r[l]];if(z===void 0)throw new SyntaxError(`Non-${n} character`);p=p<<t|z,d+=t,d>=8&&(d-=8,i[N++]=255&p>>d)}if(d>=t||255&p<<8-d)throw new SyntaxError("Unexpected end of data");return i},Je=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,o="",i=0,d=0;for(let p=0;p<r.length;++p)for(d=d<<8|r[p],i+=8;i>t;)i-=t,o+=e[s&d>>i];if(i&&(o+=e[s&d<<t-i]),n)for(;o.length*t&7;)o+="=";return o},c=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>F({prefix:e,name:r,encode(s){return Je(s,n,t)},decode(s){return qe(s,n,t,r)}});var _e=F({prefix:"\0",name:"identity",encode:r=>pe(r),decode:r=>fe(r)});var X={};m(X,{base2:()=>We});var We=c({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var G={};m(G,{base8:()=>Xe});var Xe=c({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Q={};m(Q,{base10:()=>Ge});var Ge=D({prefix:"9",name:"base10",alphabet:"0123456789"});var H={};m(H,{base16:()=>Qe,base16upper:()=>He});var Qe=c({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),He=c({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Y={};m(Y,{base32:()=>T,base32hex:()=>et,base32hexpad:()=>rt,base32hexpadupper:()=>nt,base32hexupper:()=>tt,base32pad:()=>Ze,base32padupper:()=>Ke,base32upper:()=>Ye,base32z:()=>st});var T=c({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ye=c({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ze=c({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ke=c({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),et=c({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),tt=c({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),rt=c({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),nt=c({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),st=c({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Z={};m(Z,{base36:()=>ot,base36upper:()=>it});var ot=D({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),it=D({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var K={};m(K,{base58btc:()=>S,base58flickr:()=>at});var S=D({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),at=D({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ee={};m(ee,{base64:()=>ct,base64pad:()=>dt,base64url:()=>ht,base64urlpad:()=>ft});var ct=c({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dt=c({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ht=c({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ft=c({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ne={};m(ne,{sha256:()=>Nt,sha512:()=>zt});var pt=xe,ye=128,ut=127,lt=~ut,bt=Math.pow(2,31);function xe(r,e,t){e=e||[],t=t||0;for(var n=t;r>=bt;)e[t++]=r&255|ye,r/=128;for(;r&lt;)e[t++]=r&255|ye,r>>>=7;return e[t]=r|0,xe.bytes=t-n+1,e}var mt=te,gt=128,ve=127;function te(r,e){var t=0,e=e||0,n=0,s=e,o,i=r.length;do{if(s>=i)throw te.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=n<28?(o&ve)<<n:(o&ve)*Math.pow(2,n),n+=7}while(o>=gt);return te.bytes=s-e,t}var wt=Math.pow(2,7),yt=Math.pow(2,14),xt=Math.pow(2,21),vt=Math.pow(2,28),St=Math.pow(2,35),jt=Math.pow(2,42),Et=Math.pow(2,49),At=Math.pow(2,56),Ct=Math.pow(2,63),Dt=function(r){return r<wt?1:r<yt?2:r<xt?3:r<vt?4:r<St?5:r<jt?6:r<Et?7:r<At?8:r<Ct?9:10},Ut={encode:pt,decode:mt,encodingLength:Dt},It=Ut,O=It;var B=r=>[O.decode(r),O.decode.bytes],L=(r,e,t=0)=>(O.encode(r,e,t),e),M=r=>O.encodingLength(r);var I=(r,e)=>{let t=e.byteLength,n=M(r),s=n+M(t),o=new Uint8Array(s+t);return L(r,o,0),L(t,o,n),o.set(e,s),new V(r,t,e,o)},je=r=>{let e=E(r),[t,n]=B(e),[s,o]=B(e.subarray(n)),i=e.subarray(n+o);if(i.byteLength!==s)throw new Error("Incorrect length");return new V(t,s,i,e)},Ee=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&he(r.bytes,e.bytes),V=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var re=({name:r,code:e,encode:t})=>new Ce(r,e,t),Ce=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?I(this.code,t):t.then(n=>I(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Ue=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Nt=re({name:"sha2-256",code:18,encode:Ue("SHA-256")}),zt=re({name:"sha2-512",code:19,encode:Ue("SHA-512")});var se={};m(se,{identity:()=>Mt});var Ie=0,Tt="identity",Ne=E,Lt=r=>I(Ie,Ne(r)),Mt={code:Ie,name:Tt,encode:Ne,digest:Lt};var Er=new TextEncoder,Ar=new TextDecoder;var h=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this.byteOffset=s.byteOffset,this.byteLength=s.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:q,byteLength:q,code:P,version:P,multihash:P,bytes:P,_baseCache:q,asCID:q})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==R)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==$t)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return h.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=I(e,t);return h.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Ee(this.multihash,e.multihash)}toString(e){let{bytes:t,version:n,_baseCache:s}=this;switch(n){case 0:return Rt(t,s,e||S.encoder);default:return kt(t,s,e||T.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Pt(/^0\.0/,qt),!!(e&&(e[Te]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof h)return e;if(e!=null&&e.asCID===e){let{version:t,code:n,multihash:s,bytes:o}=e;return new h(t,n,s,o||ze(t,n,s.bytes))}else if(e!=null&&e[Te]===!0){let{version:t,multihash:n,code:s}=e,o=je(n);return h.create(t,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==R)throw new Error(`Version 0 CID must use dag-pb (code: ${R}) block encoding`);return new h(e,t,n,n.bytes)}case 1:{let s=ze(e,t,n.bytes);return new h(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return h.create(0,R,e)}static createV1(e,t){return h.create(1,e,t)}static decode(e){let[t,n]=h.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=h.inspectBytes(e),n=t.size-t.multihashSize,s=E(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let o=s.subarray(t.multihashSize-t.digestSize),i=new V(t.multihashCode,t.digestSize,o,s);return[t.version===0?h.createV0(i):h.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[z,k]=B(e.subarray(t));return t+=k,z},s=n(),o=R;if(s===18?(s=0,t=0):s===1&&(o=n()),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let i=t,d=n(),p=n(),N=t+p,l=N-i;return{version:s,codec:o,multihashCode:d,digestSize:p,multihashSize:l,size:N}}static parse(e,t){let[n,s]=Vt(e,t),o=h.decode(s);return o._baseCache.set(n,e),o}},Vt=(r,e)=>{switch(r[0]){case"Q":{let t=e||S;return[S.prefix,t.decode(`${S.prefix}${r}`)]}case S.prefix:{let t=e||S;return[S.prefix,t.decode(r)]}case T.prefix:{let t=e||T;return[T.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Rt=(r,e,t)=>{let{prefix:n}=t;if(n!==S.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let o=t.encode(r).slice(1);return e.set(n,o),o}else return s},kt=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let o=t.encode(r);return e.set(n,o),o}else return s},R=112,$t=18,ze=(r,e,t)=>{let n=M(r),s=n+M(e),o=new Uint8Array(s+t.byteLength);return L(r,o,0),L(e,o,n),o.set(t,s),o},Te=Symbol.for("@ipld/js-cid/CID"),P={writable:!1,configurable:!1,enumerable:!0},q={writable:!1,enumerable:!1,configurable:!1},Ft="0.0.0-dev",Pt=(r,e)=>{if(r.test(Ft))console.warn(e);else throw new Error(e)},qt=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var oe={...W,...X,...G,...Q,...H,...Y,...Z,...K,...ee},Or={...ne,...se};function Le(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Me=Le("utf8","u",r=>{let e=new TextDecoder("utf8");return"u"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),ie=Le("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Jt={utf8:Me,"utf-8":Me,hex:oe.base16,latin1:ie,ascii:ie,binary:ie,...oe},J=Jt;function Oe(r,e="utf8"){let t=J[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}function Be(r,e="utf8"){let t=J[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}var A="/",Ve=new TextEncoder().encode(A),_=Ve[0],f=class{constructor(e,t){if(typeof e=="string")this._buf=Be(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==_)throw new Error("Invalid key")}toString(e="utf8"){return Oe(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new f(e.join(A))}static random(){return new f(ce().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new f(e):e.uint8Array?new f(e.uint8Array()):null}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=Ve),this._buf[0]!==_){let e=new Uint8Array(this._buf.byteLength+1);e.fill(_,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===_;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let s=0;s<t.length;s++){if(n.length<s+1)return!1;let o=t[s],i=n[s];if(o<i)return!0;if(o>i)return!1}return t.length<n.length}reverse(){return f.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(A).slice(1)}type(){return _t(this.baseNamespace())}name(){return Wt(this.baseNamespace())}instance(e){return new f(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(A)||(e+=A),e+=this.type(),new f(e)}parent(){let e=this.list();return e.length===1?new f(A):new f(e.slice(0,-1).join(A))}child(e){return this.toString()===A?e:e.toString()===A?this:new f(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return f.withNamespaces([...this.namespaces(),...Xt(e.map(t=>t.namespaces()))])}};function _t(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Wt(r){let e=r.split(":");return e[e.length-1]}function Xt(r){return[].concat(...r)}return Gt;})();
return InterfaceDatastore}));
