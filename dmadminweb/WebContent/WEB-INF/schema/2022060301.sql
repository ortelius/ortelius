CREATE OR REPLACE FUNCTION dm.fulldomain(val integer) RETURNS character varying AS $$ DECLARE full_domain varchar; BEGIN WITH RECURSIVE pops (id, level, name, name_path) AS (SELECT  id, 0, name, ARRAY[name] FROM    dm.dm_domain a WHERE   a.domainid is null UNION ALL SELECT  p.id, t0.level + 1, p.name, ARRAY_APPEND(t0.name_path, p.name) FROM    dm.dm_domain p INNER JOIN pops t0 ON t0.id = p.domainid) SELECT  ARRAY_TO_STRING(name_path, '.') into full_domain FROM    pops where id = $1; RETURN full_domain; END; $$ LANGUAGE plpgsql;
